<div class="chart-of-accounts-container">
  <div class="page-header">
    <h1>Chart of Accounts</h1>
    <div class="search-container">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        placeholder="Search accounts..." 
        (keyup.enter)="searchAccounts()"
      >
      <button class="search-btn" (click)="searchAccounts()">
        <i class="fas fa-search"></i>
      </button>
    </div>
    <!-- <button class="btn-primary" >
      
    </button> -->
  </div>

  <!-- Loading Indicator -->
  <div class="loading-indicator" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading accounts...</p>
  </div>

  <div class="content-container" *ngIf="!isLoading">
    <div class="accounts-tree-container">
      <!-- Tree View -->
      <div class="accounts-tree">
        <ng-container *ngIf="accounts.length > 0; else noAccounts">
          <div class="tree-view">
            <ng-container *ngTemplateOutlet="accountsTreeTemplate; context: { $implicit: accounts, level: 0 }"></ng-container>
          </div>
        </ng-container>
        
        <ng-template #noAccounts>
          <div class="no-accounts">
            <i class="fas fa-sitemap"></i>
            <p>No accounts found</p>
          </div>
        </ng-template>
        
        <!-- Recursive Tree Template -->
        <ng-template #accountsTreeTemplate let-nodes let-level="level">
          <ul class="tree-level">
            <li *ngFor="let node of nodes" class="tree-node" [class.selected]="selectedAccount?.accountCode === node.accountCode">
              <div class="node-content" (click)="selectAccount(node)">
                <button class="toggle-btn" *ngIf="node.children && node.children.length > 0" (click)="toggleNode(node); $event.stopPropagation()">
                  <i class="fas" [ngClass]="node.isExpanded ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
                </button>
                <span *ngIf="!(node.children && node.children.length > 0)" class="toggle-placeholder"></span>
                <i class="fas" [ngClass]="getNodeIcon(node)"></i>
                <span class="node-code">{{ node.accountCode }}</span>
                <span class="node-name">{{ node.accountName }}</span>
                <span class="node-type" *ngIf="node.accountType">{{ node.accountType }}</span>
              </div>
              
              <!-- Recursively render children if expanded -->
              <ul *ngIf="node.isExpanded && node.children && node.children.length > 0" class="child-nodes">
                <ng-container *ngTemplateOutlet="accountsTreeTemplate; context: { $implicit: node.children, level: level + 1 }"></ng-container>
              </ul>
            </li>
          </ul>
        </ng-template>
      </div>
    </div>

    <!-- Details Panel -->
    <div class="details-panel">
      <!-- Account Details -->
      <div class="account-details" *ngIf="selectedAccount && !showForm">
        <h2>Account Details</h2>
        <div class="details-row">
          <span class="label">Code:</span>
          <span class="value">{{ selectedAccount.accountCode }}</span>
        </div>
        <div class="details-row">
          <span class="label">Name:</span>
          <span class="value">{{ selectedAccount.accountName }}</span>
        </div>
        <div class="details-row">
          <span class="label">Type:</span>
          <span class="value">{{ selectedAccount.accountType || 'N/A' }}</span>
        </div>
        <div class="details-row">
          <span class="label">Level:</span>
          <span class="value">{{ selectedAccount.level }}</span>
        </div>
        
        <div class="actions-row">
          <button class="btn-primary" (click)="showCreateForm(selectedAccount)">
            <i class="fas fa-plus"></i> Add Sub-Account
          </button>
          <button class="btn-secondary" (click)="showUpdateForm()">
            <i class="fas fa-edit"></i> Edit
          </button>
          <button class="btn-danger" (click)="deleteAccount()">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>
      </div>

      <!-- Account Form -->
      <div class="account-form" *ngIf="showForm">
        <h2>{{ formMode === 'create' ? 'Create New Account' : 'Update Account' }}</h2>
        
        <div class="form-group" *ngIf="formMode === 'create'">
          <label for="accountCode">Account Code</label>
          <input type="text" id="accountCode" [value]="newAccount.accountCode" disabled>
          <small class="form-text text-muted">This is a preview. The final code will be generated by the server.</small>
        </div>
        
        <div class="form-group">
          <label for="accountName">Account Name</label>
          <input type="text" id="accountName" [(ngModel)]="newAccount.accountName" required>
        </div>
        
        <div class="form-group" *ngIf="formMode === 'create'">
          <label for="parentAccountCode">Parent Account</label>
          <input type="text" [value]="newAccount.parentAccountCode ? findAccountNameByCode(newAccount.parentAccountCode) : 'Root Account'" disabled>
        </div>
        
        <div class="form-actions">
          <button class="btn-primary" (click)="submitForm()">
            {{ formMode === 'create' ? 'Create' : 'Update' }}
          </button>
          <button class="btn-secondary" (click)="cancelForm()">Cancel</button>
        </div>
      </div>
      
      <!-- Empty State -->
      <div class="empty-state" *ngIf="!selectedAccount && !showForm">
        <i class="fas fa-info-circle"></i>
        <p>Select an account from the tree to view details</p>
        <!-- <button class="btn-primary mt-3" (click)="showCreateForm()">
          <i class="fas fa-plus"></i> Create Root Account
        </button> -->
      </div>
    </div>
  </div>
</div>